<!DOCTYPE html>

<html lang="en" data-content_root="./">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Matplotloom 0.9.0 &#8212; matplotloom 0.9.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=5ecbeea2" />
    <link rel="stylesheet" type="text/css" href="_static/basic.css?v=b08954a9" />
    <link rel="stylesheet" type="text/css" href="_static/alabaster.css?v=27fed22d" />
    <script src="_static/documentation_options.js?v=39bb1c6d"></script>
    <script src="_static/doctools.js?v=9bcbadda"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
          

          <div class="body" role="main">
            
  <section id="matplotloom-version">
<h1>Matplotloom 0.9.0<a class="headerlink" href="#matplotloom-version" title="Link to this heading">¶</a></h1>
<p>Matplotloom is a Python library for creating animations from matplotlib figures. It provides a simple interface to save individual frames and compile them into animations (video or GIF) using ffmpeg.</p>
<nav class="contents local" id="table-of-contents">
<p class="topic-title">Table of Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#why-use-matplotloom" id="id2">Why use matplotloom?</a></p></li>
<li><p><a class="reference internal" href="#some-notes-to-users" id="id3">Some notes to users</a></p></li>
<li><p><a class="reference internal" href="#installation" id="id4">Installation</a></p></li>
<li><p><a class="reference internal" href="#examples" id="id5">Examples</a></p>
<ul>
<li><p><a class="reference internal" href="#sine-wave" id="id6">Sine wave</a></p></li>
<li><p><a class="reference internal" href="#rotating-circular-sine-wave" id="id7">Rotating circular sine wave</a></p></li>
<li><p><a class="reference internal" href="#bessel-wave" id="id8">Bessel wave</a></p></li>
<li><p><a class="reference internal" href="#double-pendulum" id="id9">Double pendulum</a></p></li>
<li><p><a class="reference internal" href="#night-time-shading" id="id10">Night time shading</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#id1" id="id11">Looming in parallel</a></p></li>
<li><p><a class="reference internal" href="#reference" id="id12">Reference</a></p></li>
</ul>
</nav>
<section id="why-use-matplotloom">
<h2><a class="toc-backref" href="#id2" role="doc-backlink">Why use matplotloom?</a><a class="headerlink" href="#why-use-matplotloom" title="Link to this heading">¶</a></h2>
<p>To visualize simulation output for computational fluid dynamics I’ve had to make long animations with complex figures for a long time. The animations consist of thousands of frames and the figures are too complex for <code class="docutils literal notranslate"><span class="pre">FuncAnimation</span></code> and <code class="docutils literal notranslate"><span class="pre">ArtistAnimation</span></code>. This package aims to simplify and massively speed up the process of making these kinds of animations.</p>
<ul class="simple">
<li><p>The main idea behind matplotloom is to describe how to generate each frame of your animation from scratch, instead of generating an animation by modifying one existing plot. This simplifies generating animations. See the examples below and how the code inside the <code class="docutils literal notranslate"><span class="pre">for</span></code> loops is plain and familiar matplotlib. It also ensures that every feature can be animated and that the generation process can be easily parallelized.</p></li>
<li><p>matplotlib has two tools for making animations: <code class="docutils literal notranslate"><span class="pre">FuncAnimation</span></code> and <code class="docutils literal notranslate"><span class="pre">ArtistAnimation</span></code>. But to use them you have to write your plotting code differently to modify an existing frame. This makes it difficult to go from plotting still figures to making animations. And some features are non-trivial to animate.</p></li>
<li><p><a class="reference external" href="https://github.com/jwkvam/celluloid">celluloid</a> is a nice package for making matplotlib animations easily, but as it relies on <code class="docutils literal notranslate"><span class="pre">ArtistAnimation</span></code> under the hood it does come with some <a class="reference external" href="https://github.com/jwkvam/celluloid?tab=readme-ov-file#limitations">limitations</a> such as not being able to animate titles. It also hasn’t been maintained since 2018.</p></li>
<li><p>Plotting many frames (hundreds to thousands+) can be slow but with matplotloom you can use a parallel <code class="docutils literal notranslate"><span class="pre">Loom</span></code> to plot each frame in parallel, speeding up the animation process significantly especially if you can dedicate many cores to plotting.</p></li>
</ul>
</section>
<section id="some-notes-to-users">
<h2><a class="toc-backref" href="#id3" role="doc-backlink">Some notes to users</a><a class="headerlink" href="#some-notes-to-users" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p>You can use <code class="docutils literal notranslate"><span class="pre">loom.show()</span></code> to display animations in Jupyter notebooks.</p></li>
<li><p>Anxious about animation progress? Pass <code class="docutils literal notranslate"><span class="pre">verbose=True</span></code> or use <a class="reference external" href="https://github.com/tqdm/tqdm">tqdm</a> to monitor progress.</p></li>
<li><p>Animations taking too long to make or do you have tons of frames? You can parallelize frame creating by <a class="reference external" href="#looming-in-parallel">looming in parallel</a>.</p></li>
<li><p>You have to call <code class="docutils literal notranslate"><span class="pre">loom.save_frame(fig)</span></code> for each frame (see the examples). While the <code class="docutils literal notranslate"><span class="pre">Loom</span></code> object can be made to do this automatically it would have to create and own the <code class="docutils literal notranslate"><span class="pre">Figure</span></code> instance and I wanted full control over the creation of the <code class="docutils literal notranslate"><span class="pre">Figure</span></code> for maximum flexibility.</p></li>
<li><p>matplotloom is going to be slow. But it’s flexible and compatible with all of matplotlib! The real speedup comes from parallelizing frame creation, especially if you have a ton of frames to make.</p></li>
</ul>
</section>
<section id="installation">
<h2><a class="toc-backref" href="#id4" role="doc-backlink">Installation</a><a class="headerlink" href="#installation" title="Link to this heading">¶</a></h2>
<p>matplotloom is published on PyPI so you can install matplotloom via <code class="docutils literal notranslate"><span class="pre">pip</span></code></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pip<span class="w"> </span>install<span class="w"> </span>matplotloom
</pre></div>
</div>
<p>or <cite>uv</cite></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>uv<span class="w"> </span>add<span class="w"> </span>matplotloom
</pre></div>
</div>
<p>or <code class="docutils literal notranslate"><span class="pre">poetry</span></code></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>poetry<span class="w"> </span>add<span class="w"> </span>matplotloom
</pre></div>
</div>
<p>or <code class="docutils literal notranslate"><span class="pre">conda</span></code></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>conda<span class="w"> </span>install<span class="w"> </span>matplotloom
</pre></div>
</div>
<p>matplotloom requires Python 3.10+ and is continuously tested on Linux, Windows, and Mac. Ensure you have <code class="docutils literal notranslate"><span class="pre">ffmpeg</span></code> installed so that animations can be generated.</p>
</section>
<section id="examples">
<h2><a class="toc-backref" href="#id5" role="doc-backlink">Examples</a><a class="headerlink" href="#examples" title="Link to this heading">¶</a></h2>
<section id="sine-wave">
<h3><a class="toc-backref" href="#id6" role="doc-backlink">Sine wave</a><a class="headerlink" href="#sine-wave" title="Link to this heading">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">matplotloom</span><span class="w"> </span><span class="kn">import</span> <span class="n">Loom</span>

<span class="k">with</span> <span class="n">Loom</span><span class="p">(</span><span class="s2">&quot;sine_wave_animation.gif&quot;</span><span class="p">,</span> <span class="n">fps</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span> <span class="k">as</span> <span class="n">loom</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">phase</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="mi">100</span><span class="p">):</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>

        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">phase</span><span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>

        <span class="n">loom</span><span class="o">.</span><span class="n">save_frame</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
</pre></div>
</div>
<img alt="https://raw.githubusercontent.com/ali-ramadhan/matplotloom/main/examples/sine_wave.gif" src="https://raw.githubusercontent.com/ali-ramadhan/matplotloom/main/examples/sine_wave.gif" />
</section>
<section id="rotating-circular-sine-wave">
<h3><a class="toc-backref" href="#id7" role="doc-backlink">Rotating circular sine wave</a><a class="headerlink" href="#rotating-circular-sine-wave" title="Link to this heading">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">matplotloom</span><span class="w"> </span><span class="kn">import</span> <span class="n">Loom</span>

<span class="k">with</span> <span class="n">Loom</span><span class="p">(</span><span class="s2">&quot;rotating_circular_sine_wave.mp4&quot;</span><span class="p">,</span> <span class="n">fps</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span> <span class="k">as</span> <span class="n">loom</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">36</span><span class="p">):</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span> <span class="n">subplot_kw</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;projection&quot;</span><span class="p">:</span> <span class="s2">&quot;3d&quot;</span><span class="p">})</span>

        <span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">)</span>
        <span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">)</span>
        <span class="n">X</span><span class="p">,</span> <span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">)</span>
        <span class="n">R</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">X</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">Y</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">Z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">R</span><span class="p">)</span>

        <span class="n">surf</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">plot_surface</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">Z</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;coolwarm&quot;</span><span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">view_init</span><span class="p">(</span><span class="n">azim</span><span class="o">=</span><span class="n">i</span><span class="o">*</span><span class="mi">10</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_zlim</span><span class="p">(</span><span class="o">-</span><span class="mf">1.01</span><span class="p">,</span> <span class="mf">1.01</span><span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">surf</span><span class="p">,</span> <span class="n">shrink</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

        <span class="n">loom</span><span class="o">.</span><span class="n">save_frame</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
</pre></div>
</div>
<video style="width: 100%; height: auto;" controls>
  <source src="https://github.com/ali-ramadhan/matplotloom/assets/20099589/d7a6f5aa-a5b8-4e1f-9287-61aae154255a" type="video/mp4">
</video></section>
<section id="bessel-wave">
<h3><a class="toc-backref" href="#id8" role="doc-backlink">Bessel wave</a><a class="headerlink" href="#bessel-wave" title="Link to this heading">¶</a></h3>
<p>Compare with <a class="reference external" href="https://github.com/t-makaro/animatplot">animatplot</a>’s <a class="reference external" href="https://github.com/t-makaro/animatplot/blob/master/docs/source/tutorial/blocks.ipynb">blocks example</a>. With matplotloom you just use regular matplotlib abstractions.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">scipy.special</span><span class="w"> </span><span class="kn">import</span> <span class="n">j0</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">cmocean</span><span class="w"> </span><span class="kn">import</span> <span class="n">cm</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">matplotloom</span><span class="w"> </span><span class="kn">import</span> <span class="n">Loom</span>

<span class="k">def</span><span class="w"> </span><span class="nf">bessel_wave</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">omega</span><span class="p">,</span> <span class="n">A</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">A</span> <span class="o">*</span> <span class="n">j0</span><span class="p">(</span><span class="n">k</span><span class="o">*</span><span class="n">r</span> <span class="o">-</span> <span class="n">omega</span><span class="o">*</span><span class="n">t</span><span class="p">)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">create_frame</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
    <span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>

    <span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">y</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">z</span> <span class="o">=</span> <span class="n">bessel_wave</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">omega</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">A</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">pcm</span> <span class="o">=</span> <span class="n">ax1</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="o">.</span><span class="n">balance</span><span class="p">,</span> <span class="n">shading</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">pcm</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax1</span><span class="p">)</span>

    <span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Bessel wave: t = </span><span class="si">{</span><span class="n">t</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s2">&quot;equal&quot;</span><span class="p">,</span> <span class="n">adjustable</span><span class="o">=</span><span class="s2">&quot;box&quot;</span><span class="p">)</span>

    <span class="n">mid</span> <span class="o">=</span> <span class="n">z</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">//</span> <span class="mi">2</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">mid</span><span class="p">],</span> <span class="n">z</span><span class="p">[</span><span class="n">mid</span><span class="p">])</span>

    <span class="n">ax2</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">x</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">1.1</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Cross-section at y = 0&quot;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">fig</span>

<span class="n">loom</span> <span class="o">=</span> <span class="n">Loom</span><span class="p">(</span>
    <span class="s2">&quot;bessel_wave.mp4&quot;</span><span class="p">,</span>
    <span class="n">fps</span> <span class="o">=</span> <span class="mi">30</span><span class="p">,</span>
    <span class="n">overwrite</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">verbose</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">savefig_kwargs</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;dpi&quot;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span>
        <span class="s2">&quot;bbox_inches&quot;</span><span class="p">:</span> <span class="s2">&quot;tight&quot;</span>
    <span class="p">}</span>
<span class="p">)</span>

<span class="k">with</span> <span class="n">loom</span><span class="p">:</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">300</span><span class="p">):</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">create_frame</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>
        <span class="n">loom</span><span class="o">.</span><span class="n">save_frame</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
</pre></div>
</div>
<video style="width: 100%; height: auto;" controls>
  <source src="https://github.com/ali-ramadhan/matplotloom/assets/20099589/fdbe9549-1e98-40b4-80ad-fc99f1531e39" type="video/mp4">
</video></section>
<section id="double-pendulum">
<h3><a class="toc-backref" href="#id9" role="doc-backlink">Double pendulum</a><a class="headerlink" href="#double-pendulum" title="Link to this heading">¶</a></h3>
<p>Compare with <a class="reference external" href="https://matplotlib.org/stable/gallery/animation/double_pendulum.html#sphx-glr-gallery-animation-double-pendulum-py">matplotlib’s double pendulum</a> example.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">scipy.integrate</span><span class="w"> </span><span class="kn">import</span> <span class="n">solve_ivp</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">tqdm</span><span class="w"> </span><span class="kn">import</span> <span class="n">tqdm</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">matplotloom</span><span class="w"> </span><span class="kn">import</span> <span class="n">Loom</span>

<span class="n">g</span> <span class="o">=</span> <span class="mf">9.80665</span> <span class="c1"># standard acceleration of gravity [m/s²]</span>
<span class="n">l1</span><span class="p">,</span> <span class="n">l2</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span>  <span class="c1"># pendulum arms lengths [m]</span>
<span class="n">m1</span><span class="p">,</span> <span class="n">m2</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span>  <span class="c1"># pendulum masses [kg]</span>

<span class="c1"># Calculate dy/dt where y = [θ1, ω1, θ2, ω2].</span>
<span class="k">def</span><span class="w"> </span><span class="nf">derivatives</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
    <span class="n">θ1</span><span class="p">,</span> <span class="n">ω1</span><span class="p">,</span> <span class="n">θ2</span><span class="p">,</span> <span class="n">ω2</span> <span class="o">=</span> <span class="n">state</span>
    <span class="n">dydt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>

    <span class="n">dydt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">ω1</span>
    <span class="n">dydt</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">ω2</span>

    <span class="n">Δθ</span> <span class="o">=</span> <span class="n">θ2</span> <span class="o">-</span> <span class="n">θ1</span>

    <span class="n">denominator1</span> <span class="o">=</span> <span class="p">(</span><span class="n">m1</span> <span class="o">+</span> <span class="n">m2</span><span class="p">)</span> <span class="o">*</span> <span class="n">l1</span> <span class="o">-</span> <span class="n">m2</span> <span class="o">*</span> <span class="n">l1</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">Δθ</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
    <span class="n">dydt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">m2</span> <span class="o">*</span> <span class="n">l1</span> <span class="o">*</span> <span class="n">ω1</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">Δθ</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">Δθ</span><span class="p">)</span>
            <span class="o">+</span> <span class="n">m2</span> <span class="o">*</span> <span class="n">g</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">θ2</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">Δθ</span><span class="p">)</span>
            <span class="o">+</span> <span class="n">m2</span> <span class="o">*</span> <span class="n">l2</span> <span class="o">*</span> <span class="n">ω2</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">Δθ</span><span class="p">)</span>
            <span class="o">-</span> <span class="p">(</span><span class="n">m1</span> <span class="o">+</span> <span class="n">m2</span><span class="p">)</span> <span class="o">*</span> <span class="n">g</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">θ1</span><span class="p">))</span> <span class="o">/</span> <span class="n">denominator1</span>

    <span class="n">denominator2</span> <span class="o">=</span> <span class="p">(</span><span class="n">l2</span> <span class="o">/</span> <span class="n">l1</span><span class="p">)</span> <span class="o">*</span> <span class="n">denominator1</span>
    <span class="n">dydt</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="n">m2</span> <span class="o">*</span> <span class="n">l2</span> <span class="o">*</span> <span class="n">ω2</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">Δθ</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">Δθ</span><span class="p">)</span>
            <span class="o">+</span> <span class="p">(</span><span class="n">m1</span> <span class="o">+</span> <span class="n">m2</span><span class="p">)</span> <span class="o">*</span> <span class="n">g</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">θ1</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">Δθ</span><span class="p">)</span>
            <span class="o">-</span> <span class="p">(</span><span class="n">m1</span> <span class="o">+</span> <span class="n">m2</span><span class="p">)</span> <span class="o">*</span> <span class="n">l1</span> <span class="o">*</span> <span class="n">ω1</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">Δθ</span><span class="p">)</span>
            <span class="o">-</span> <span class="p">(</span><span class="n">m1</span> <span class="o">+</span> <span class="n">m2</span><span class="p">)</span> <span class="o">*</span> <span class="n">g</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">θ2</span><span class="p">))</span> <span class="o">/</span> <span class="n">denominator2</span>

    <span class="k">return</span> <span class="n">dydt</span>

<span class="n">t_span</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
<span class="n">y0</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
<span class="n">sol</span> <span class="o">=</span> <span class="n">solve_ivp</span><span class="p">(</span><span class="n">derivatives</span><span class="p">,</span> <span class="n">t_span</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">dense_output</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">times</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">t_span</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">t_span</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">1000</span><span class="p">)</span>

<span class="n">θ1</span><span class="p">,</span> <span class="n">ω1</span><span class="p">,</span> <span class="n">θ2</span><span class="p">,</span> <span class="n">ω2</span> <span class="o">=</span> <span class="n">sol</span><span class="o">.</span><span class="n">sol</span><span class="p">(</span><span class="n">times</span><span class="p">)</span>
<span class="n">x1</span> <span class="o">=</span>  <span class="n">l1</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">θ1</span><span class="p">)</span>
<span class="n">y1</span> <span class="o">=</span> <span class="o">-</span><span class="n">l1</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">θ1</span><span class="p">)</span>
<span class="n">x2</span> <span class="o">=</span> <span class="n">x1</span> <span class="o">+</span> <span class="n">l2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">θ2</span><span class="p">)</span>
<span class="n">y2</span> <span class="o">=</span> <span class="n">y1</span> <span class="o">-</span> <span class="n">l2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">θ2</span><span class="p">)</span>

<span class="n">loom</span> <span class="o">=</span> <span class="n">Loom</span><span class="p">(</span>
    <span class="s2">&quot;double_pendulum.mp4&quot;</span><span class="p">,</span>
    <span class="n">fps</span> <span class="o">=</span> <span class="mi">60</span><span class="p">,</span>
    <span class="n">overwrite</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">savefig_kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;bbox_inches&quot;</span><span class="p">:</span> <span class="s2">&quot;tight&quot;</span><span class="p">}</span>
<span class="p">)</span>

<span class="k">with</span> <span class="n">loom</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">enumerate</span><span class="p">(</span><span class="n">times</span><span class="p">),</span> <span class="n">total</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">times</span><span class="p">)):</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">x1</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">x2</span><span class="p">[</span><span class="n">i</span><span class="p">]],</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">y1</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">y2</span><span class="p">[</span><span class="n">i</span><span class="p">]],</span>
            <span class="n">linestyle</span> <span class="o">=</span> <span class="s2">&quot;solid&quot;</span><span class="p">,</span>
            <span class="n">marker</span> <span class="o">=</span> <span class="s2">&quot;o&quot;</span><span class="p">,</span>
            <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;black&quot;</span><span class="p">,</span>
            <span class="n">linewidth</span> <span class="o">=</span> <span class="mi">3</span>
        <span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
            <span class="n">x2</span><span class="p">[:</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span>
            <span class="n">y2</span><span class="p">[:</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span>
            <span class="n">linestyle</span> <span class="o">=</span> <span class="s2">&quot;solid&quot;</span><span class="p">,</span>
            <span class="n">linewidth</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
            <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;red&quot;</span><span class="p">,</span>
            <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.5</span>
        <span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Double Pendulum: t = </span><span class="si">{</span><span class="n">t</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">s&quot;</span><span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">-</span><span class="mf">2.2</span><span class="p">,</span> <span class="mf">2.2</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">2.2</span><span class="p">,</span> <span class="mf">2.2</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s2">&quot;equal&quot;</span><span class="p">,</span> <span class="n">adjustable</span><span class="o">=</span><span class="s2">&quot;box&quot;</span><span class="p">)</span>

        <span class="n">loom</span><span class="o">.</span><span class="n">save_frame</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
</pre></div>
</div>
<video style="width: 100%; height: auto;" controls>
  <source src="https://github.com/ali-ramadhan/matplotloom/assets/20099589/1224f357-c435-4cd2-abb3-970d8e42eeb3" type="video/mp4">
</video></section>
<section id="night-time-shading">
<h3><a class="toc-backref" href="#id10" role="doc-backlink">Night time shading</a><a class="headerlink" href="#night-time-shading" title="Link to this heading">¶</a></h3>
<p>matplotloom works out of the box with anything that is built on top of matplotlib. Here we’re extending a <a class="reference external" href="https://scitools.org.uk/cartopy/docs/latest/gallery/lines_and_polygons/nightshade.html#sphx-glr-gallery-lines-and-polygons-nightshade-py">Cartopy example</a>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">datetime</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">cartopy.crs</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">ccrs</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">cartopy.feature.nightshade</span><span class="w"> </span><span class="kn">import</span> <span class="n">Nightshade</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">joblib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Parallel</span><span class="p">,</span> <span class="n">delayed</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">matplotloom</span><span class="w"> </span><span class="kn">import</span> <span class="n">Loom</span>

<span class="k">def</span><span class="w"> </span><span class="nf">plot_frame</span><span class="p">(</span><span class="n">day_of_year</span><span class="p">,</span> <span class="n">loom</span><span class="p">,</span> <span class="n">frame_number</span><span class="p">):</span>
    <span class="n">date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2024</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span> <span class="o">+</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="n">day_of_year</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>

    <span class="n">proj1</span> <span class="o">=</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">Orthographic</span><span class="p">(</span><span class="n">central_longitude</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">central_latitude</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
    <span class="n">proj2</span> <span class="o">=</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">Orthographic</span><span class="p">(</span><span class="n">central_longitude</span><span class="o">=</span><span class="mi">120</span><span class="p">,</span> <span class="n">central_latitude</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">proj3</span> <span class="o">=</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">Orthographic</span><span class="p">(</span><span class="n">central_longitude</span><span class="o">=</span><span class="mi">240</span><span class="p">,</span> <span class="n">central_latitude</span><span class="o">=-</span><span class="mi">30</span><span class="p">)</span>

    <span class="n">ax1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="n">proj1</span><span class="p">)</span>
    <span class="n">ax2</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="n">proj2</span><span class="p">)</span>
    <span class="n">ax3</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="n">proj3</span><span class="p">)</span>

    <span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Night time shading for </span><span class="si">{</span><span class="n">date</span><span class="si">}</span><span class="s2"> UTC&quot;</span><span class="p">)</span>

    <span class="n">ax1</span><span class="o">.</span><span class="n">stock_img</span><span class="p">()</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span><span class="n">Nightshade</span><span class="p">(</span><span class="n">date</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">))</span>

    <span class="n">ax2</span><span class="o">.</span><span class="n">stock_img</span><span class="p">()</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span><span class="n">Nightshade</span><span class="p">(</span><span class="n">date</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">))</span>

    <span class="n">ax3</span><span class="o">.</span><span class="n">stock_img</span><span class="p">()</span>
    <span class="n">ax3</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span><span class="n">Nightshade</span><span class="p">(</span><span class="n">date</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">))</span>

    <span class="n">loom</span><span class="o">.</span><span class="n">save_frame</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">frame_number</span><span class="p">)</span>

<span class="n">loom</span> <span class="o">=</span> <span class="n">Loom</span><span class="p">(</span>
    <span class="s2">&quot;night_time_shading.mp4&quot;</span><span class="p">,</span>
    <span class="n">fps</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
    <span class="n">overwrite</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">parallel</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">verbose</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">savefig_kwargs</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;bbox_inches&quot;</span><span class="p">:</span> <span class="s2">&quot;tight&quot;</span>
    <span class="p">}</span>
<span class="p">)</span>

<span class="k">with</span> <span class="n">loom</span><span class="p">:</span>
    <span class="n">n_days_2024</span> <span class="o">=</span> <span class="mi">366</span>
    <span class="n">days_of_year</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n_days_2024</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

    <span class="n">Parallel</span><span class="p">(</span><span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">)(</span>
        <span class="n">delayed</span><span class="p">(</span><span class="n">plot_frame</span><span class="p">)(</span><span class="n">day_of_year</span><span class="p">,</span> <span class="n">loom</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">day_of_year</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">days_of_year</span><span class="p">)</span>
    <span class="p">)</span>
</pre></div>
</div>
<video style="width: 100%; height: auto;" controls>
  <source src="https://github.com/ali-ramadhan/matplotloom/assets/20099589/dad48d56-73ae-4cb2-ba71-d21855c72215" type="video/mp4">
</video></section>
</section>
<section id="id1">
<h2><a class="toc-backref" href="#id11" role="doc-backlink">Looming in parallel</a><a class="headerlink" href="#id1" title="Link to this heading">¶</a></h2>
<p>By passing <code class="docutils literal notranslate"><span class="pre">parallel=True</span></code> when creating a <code class="docutils literal notranslate"><span class="pre">Loom</span></code>, you can save frames using <code class="docutils literal notranslate"><span class="pre">loom.save_frame(fig,</span> <span class="pre">frame_number)</span></code> which allows you to plot and save all your frames in parallel. One easy way to leverage this is by using joblib to parallelize the for loop. For example, here’s how you can parallelize the simple sine wave example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">matplotloom</span><span class="w"> </span><span class="kn">import</span> <span class="n">Loom</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">joblib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Parallel</span><span class="p">,</span> <span class="n">delayed</span>

<span class="k">def</span><span class="w"> </span><span class="nf">plot_frame</span><span class="p">(</span><span class="n">phase</span><span class="p">,</span> <span class="n">frame_number</span><span class="p">,</span> <span class="n">loom</span><span class="p">):</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>

    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">phase</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>

    <span class="n">loom</span><span class="o">.</span><span class="n">save_frame</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">frame_number</span><span class="p">)</span>

<span class="k">with</span> <span class="n">Loom</span><span class="p">(</span><span class="s2">&quot;parallel_sine_wave.gif&quot;</span><span class="p">,</span> <span class="n">fps</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">parallel</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="k">as</span> <span class="n">loom</span><span class="p">:</span>
    <span class="n">phases</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>

    <span class="n">Parallel</span><span class="p">(</span><span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">)(</span>
        <span class="n">delayed</span><span class="p">(</span><span class="n">plot_frame</span><span class="p">)(</span><span class="n">phase</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">loom</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">phase</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">phases</span><span class="p">)</span>
    <span class="p">)</span>
</pre></div>
</div>
</section>
<section id="reference">
<h2><a class="toc-backref" href="#id12" role="doc-backlink">Reference</a><a class="headerlink" href="#reference" title="Link to this heading">¶</a></h2>
<dl class="py class">
<dt class="sig sig-object py" id="matplotloom.Loom">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">matplotloom.</span></span><span class="sig-name descname"><span class="pre">Loom</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">output_filepath</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Path</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fps</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">30</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">frames_directory</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Path</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">keep_frames</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">overwrite</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">parallel</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">odd_dimension_handling</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'round_up'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">savefig_kwargs</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">show_ffmpeg_output</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#matplotloom.Loom" title="Link to this definition">¶</a></dt>
<dd><p>A class for creating animations from matplotlib figures.</p>
<p>This class provides functionality to save individual frames and compile them into
an animation (video or GIF) using ffmpeg.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>output_filepath</strong> (<em>Union</em><em>[</em><em>Path</em><em>, </em><em>str</em><em>]</em>) – Path to save the final animation file.</p></li>
<li><p><strong>fps</strong> (<em>int</em><em>, </em><em>optional</em>) – Frames per second for the output animation. Default is 30.</p></li>
<li><p><strong>frames_directory</strong> (<em>Union</em><em>[</em><em>Path</em><em>, </em><em>str</em><em>, </em><em>None</em><em>]</em><em>, </em><em>optional</em>) – Directory to save individual frames. If None, a temporary directory is used.</p></li>
<li><p><strong>keep_frames</strong> (<em>bool</em><em>, </em><em>optional</em>) – Whether to keep individual frame files after creating the animation.
Default is False.</p></li>
<li><p><strong>overwrite</strong> (<em>bool</em><em>, </em><em>optional</em>) – Whether to overwrite the output file if it already exists. Default is False.</p></li>
<li><p><strong>parallel</strong> (<em>bool</em><em>, </em><em>optional</em>) – <p>Whether to enable parallel frame saving. Default is False.
When True, this enables a mode where frames can be saved concurrently,
significantly speeding up the animation creation process for computationally
intensive plots or large numbers of frames.</p>
<dl class="simple">
<dt>In parallel mode:</dt><dd><ul>
<li><p>The <cite>save_frame</cite> method requires an explicit frame number.</p></li>
<li><p>Frames can be created and saved in any order.</p></li>
<li><p>The user is responsible for parallelizing the frame creation process,
typically using tools like joblib, multiprocessing, or concurrent.futures.</p></li>
</ul>
</dd>
</dl>
</p></li>
<li><p><strong>odd_dimension_handling</strong> (<em>str</em><em>, </em><em>optional</em>) – How to handle odd pixel dimensions that some codecs (like H.264) cannot process.
Options:
- “round_up”: Scale filter rounds up to next even dimension (default)
- “round_down”: Scale filter rounds down to previous even dimension
- “crop”: Crop 1 pixel from bottom/right edges if dimensions are odd
- “pad”: Add 1 pixel of padding to bottom/right edges if dimensions are odd
- “none”: Do nothing, let FFmpeg handle it (may fail for some codecs)
Default is “round_up”.</p></li>
<li><p><strong>savefig_kwargs</strong> (<em>dict</em><em>, </em><em>optional</em>) – Additional keyword arguments to pass to matplotlib’s savefig function.
Default is {}.</p></li>
<li><p><strong>verbose</strong> (<em>bool</em><em>, </em><em>optional</em>) – Whether to print detailed information during the process. Default is False.</p></li>
<li><p><strong>show_ffmpeg_output</strong> (<em>bool</em><em>, </em><em>optional</em>) – Whether to show ffmpeg output when saving the video. Default is False.
When True, the ffmpeg command and its stdout/stderr output will be printed
during video creation, regardless of the verbose setting.</p></li>
</ul>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>FileExistsError</strong> – If the output file already exists and overwrite is False.</p>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="matplotloom.Loom.save_frame">
<span class="sig-name descname"><span class="pre">save_frame</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">fig</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Figure</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">frame_number</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#matplotloom.Loom.save_frame" title="Link to this definition">¶</a></dt>
<dd><p>Save a single frame of the animation.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>fig</strong> (<em>matplotlib.figure.Figure</em>) – The matplotlib figure to save.</p></li>
<li><p><strong>frame_number</strong> (<em>int</em><em>, </em><em>optional</em>) – The frame number (required if parallel=True).</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="matplotloom.Loom.save_video">
<span class="sig-name descname"><span class="pre">save_video</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#matplotloom.Loom.save_video" title="Link to this definition">¶</a></dt>
<dd><p>Compile saved frames into a video or GIF using ffmpeg.</p>
<p>This method uses ffmpeg to create the final animation from the saved frames.
The output format is determined by the file extension of the output filepath.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="matplotloom.Loom.show">
<span class="sig-name descname"><span class="pre">show</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Video</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">Image</span></span></span><a class="headerlink" href="#matplotloom.Loom.show" title="Link to this definition">¶</a></dt>
<dd><p>Display the created animation in a Jupyter notebook.</p>
<p>This method returns an IPython display object that can be used to show
the animation directly in a Jupyter notebook cell. The type of object
returned depends on the file format of the animation.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>**kwargs</strong> – Keyword arguments that will be passed to either IPython.display.Video
or IPython.display.Image constructor depending on the file format.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>An IPython Video object for MP4 or MKV formats, or an IPython Image
object for GIF or APNG formats. These objects can be displayed
directly in a Jupyter notebook.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>Union[IPython.display.Video, IPython.display.Image]</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>This method is designed to work in Jupyter notebooks. It may not have
the desired effect in other Python environments.</p>
<p>The animation file must have been successfully created by the <cite>save_video</cite>
method before calling this method.</p>
</dd></dl>

</dd></dl>

</section>
</section>


          </div>
          
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2024-2025, Ali Ramadhan.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 8.2.3</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 1.0.0</a>
      
      |
      <a href="_sources/index.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>